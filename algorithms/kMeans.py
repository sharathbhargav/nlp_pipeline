import numpy as np
import individualModules as im
import matplotlib.pyplot as plot
from gensim.models.keyedvectors import KeyedVectors
from matplotlib import style
style.use("ggplot")
trainingModelGoogle = KeyedVectors.load_word2vec_format("/home/sharathbhragav/PycharmProjects/nlp_pipeline/models/GoogleNews-vectors-negative300.bin",binary=True,limit=100000)
im.setModel(trainingModelGoogle)

testData= np.array([[ 0.02005346 , 0.04187598],
 [ 0.0269297  ,0.03662949],
 [ 0.0530976  ,0.03613571],
 [ 0.0225159  ,0.04469353],
 [ 0.02389053 ,0.03895409],
 [ 0.02834501 ,0.02974286],
 [ 0.01130847 ,0.04768526],
 [ 0.00978073 ,0.02735387],
 [ 0.03794475 ,0.02182011],
 [ 0.00162057 ,0.04919974],
 [ 0.03145508 ,0.03313875],
 [ 0.00852133 ,0.03099454],
 [ 0.01560259 ,0.02823484],
 [-0.00422041 ,0.01526159],
 [ 0.04132045 ,0.02818147],
 [ 0.04475506 ,0.03509148],
 [-0.02194052 ,0.03734881],
 [ 0.00400528 ,0.01712263],
 [ 0.0055555  ,0.05298047],
 [ 0.01741135 ,0.04734326],
 [ 0.03772152 ,0.04090468],
 [ 0.03362638 ,0.05987096],
 [ 0.03063446 ,0.03921822],
 [ 0.00696157 ,0.05571747],
 [ 0.01408211 ,0.02142394],
 [ 0.00355669 ,0.04558016],
 [ 0.02966675 ,0.0264083 ],
 [ 0.0068275  ,0.02802132],
 [ 0.02856688 ,0.0543265 ],
 [ 0.04917269 ,0.0405379 ],
 [ 0.04916801 ,0.05210285],
 [ 0.01728847 ,0.05174215],
 [ 0.02710887 ,0.02541822],
 [-0.0073702  ,0.04535492],
 [ 0.03844422 ,0.04759327],
 [-0.00474244 ,0.01481936],
 [ 0.01428212 ,0.02968334],
 [ 0.01712888 ,0.02045383],
 [ 0.01351715 ,0.044321  ],
 [-0.00342654 ,0.03428979],
 [ 0.02559777 ,0.03115664],
 [ 0.03764131 ,0.02780356],
 [ 0.01503677 ,0.03315215],
 [ 0.02989884 ,0.04555046],
 [ 0.04670358 ,0.04448063],
 [-0.00171758 ,0.02573186],
 [ 0.0270135  ,0.01500936],
 [ 0.04178566 ,0.04848859],
 [ 0.02870733 ,0.03587893],
 [ 0.04765934 ,0.02786038],
 [ 0.04179009 ,0.04811273],
 [ 0.02402108 ,0.02948942],
 [ 0.00023659 ,0.03715984],
 [ 0.03000558 ,0.05858085],
 [ 0.0197839  ,0.03957514],
 [ 0.03670355 ,0.02780888],
 [-0.01355617 ,0.02847296],
 [-0.01176837 ,0.03738107],
 [ 0.00863629 ,0.04274372],
 [ 0.04250681 ,0.02371604],
 [ 0.02905892 ,0.03465177],
 [ 0.03302855 ,0.0356301 ],
 [-0.00245573 ,0.02734524],
 [-0.0195648  ,0.05218951],
 [ 0.03605272 ,0.04860569],
 [ 0.00031987 ,0.03685119],
 [ 0.00444765 ,0.02587517],
 [-0.00185149 ,0.03012299],
 [ 0.017947   ,0.03190258],
 [ 0.05744295 ,0.00267663],
 [ 0.02385681 ,0.00863176],
 [-0.00861423 ,0.03517001],
 [ 0.02598137 ,0.03212709],
 [ 0.02520837 ,0.04725049],
 [ 0.04314675 ,0.02723587],
 [ 0.00794456 ,0.00934833],
 [-0.00185149 ,0.03012299],
 [-0.00764783 ,0.02959334],
 [ 0.03358944 ,0.03967642],
 [ 0.01457332 ,0.05901105],
 [ 0.01338226 ,0.00770723],
 [ 0.01353561 ,0.02871491],
 [ 0.02184287 ,0.01757669],
 [-0.00151615 ,0.04582081],
 [ 0.01100798 ,0.02781228],
 [ 0.01918593 ,0.01028629],
 [ 0.02335429 ,0.02093169],
 [ 0.01482158 ,0.02660908],
 [ 0.0223418  ,0.02939682],
 [ 0.01483584 ,0.03415136],
 [-0.00645824 ,0.07741919],
 [ 0.00757385 ,0.01161193],
 [ 0.00117705 ,0.03245441],
 [ 0.0418425  ,0.03346921],
 [ 0.0106424  ,0.03596293],
 [ 0.01685144 ,0.02368069],
 [-0.00682574 ,0.04387524],
 [ 0.00405932 ,0.04947262],
 [ 0.03954295 ,0.01896811],
 [ 0.02529822 ,0.03566315],
 [ 0.03051175 ,0.0379232 ],
 [ 0.01058851 ,0.02069546],
 [ 0.0125124  ,0.04517808],
 [ 0.03472261 ,0.04007574],
 [ 0.04376106 ,0.05471005],
 [ 0.0034727  ,0.0149018 ],
 [ 0.03188769 ,0.02427935],
 [ 0.04257792 ,0.04783682],
 [ 0.00366898 ,0.04482679],
 [ 0.01778118 ,0.01815549],
 [ 0.0232564  ,0.05513849],
 [ 0.03523987 ,0.05207088],
 [-0.00687231 ,0.03568183],
 [ 0.0265079  ,0.02448526],
 [ 0.05447537 ,0.03307692],
 [ 0.01844445 ,0.04263507],
 [ 0.0070629  ,0.02715444],
 [-0.02654813 ,0.01664157],
 [ 0.00175625 ,0.03083976],
 [ 0.04271952 ,0.02451465],
 [ 0.04622192 ,0.03634413],
 [ 0.00391068 ,0.03490181],
 [-0.00190092 ,0.03945632],
 [ 0.01654798 ,0.01745186],
 [-0.02889648 ,0.06099313],
 [ 0.03531791 ,0.05613757],
 [ 0.05127311 ,0.03738959],
 [ 0.04141141 ,0.02840999],
 [ 0.04025991 ,0.03071905],
 [-0.00705963 ,0.05077041],
 [ 0.01936869 ,0.05208065],
 [-0.02442236 ,0.01397909],
 [-0.00036074 ,0.04589139],
 [ 0.03139823 ,0.0396828 ],
 [ 0.04002199 ,0.04236326],
 [ 0.05078371 ,0.04479903],
 [ 0.05957363 ,0.03900598],
 [ 0.00462309 ,0.05036331],
 [ 0.03369072 ,0.0310412 ],
 [ 0.05146311 ,0.03595068],
 [ 0.03611691 ,0.02917055],
 [ 0.04481173 ,0.04457549],
 [ 0.04155397 ,0.0078244 ],
 [ 0.03484906 ,0.04051792],
 [-0.01024744 ,0.04135742],
 [ 0.00053494 ,0.04348283],
 [ 0.02963689 ,0.03055985],
 [ 0.01449865 ,0.04577222],
 [ 0.01867725 ,0.01337339],
 [ 0.02879204 ,0.03589393],
 [ 0.00614642 ,0.02550879],
 [ 0.01575411 ,0.04634398],
 [ 0.04122037 ,0.05212562],
 [ 0.02520837 ,0.04725049],
 [ 0.04963232 ,0.03700013],
 [ 0.00239103 ,0.03175938],
 [ 0.05259054 ,0.02939301],
 [ 0.03121156 ,0.05660522],
 [ 0.04086327 ,0.03924075],
 [ 0.02251456 ,0.02746726],
 [ 0.00729664 ,0.00951464],
 [-0.00289816 ,0.02650727],
 [-0.00753625 ,0.02921308],
 [ 0.00305284 ,0.02147876],
 [ 0.04900244 ,0.01830776],
 [-0.01500172 ,0.03092303],
 [ 0.00921021 ,0.02759142],
 [-0.02654813 ,0.01664157],
 [ 0.03184749 ,0.03639152],
 [-0.01584271 ,0.04226929],
 [ 0.00847618 ,0.04441905],
 [ 0.01491346 ,0.04809116],
 [-0.0053571  ,0.01578856],
 [ 0.01494886 ,0.03674252],
 [-0.01084967 ,0.02299916],
 [ 0.00205816 ,0.03210492],
 [ 0.0326424  ,0.02956733],
 [ 0.02463794 ,0.04132432],
 [-0.01098711 ,0.03684599],
 [ 0.0058006  ,0.0378661 ],
 [ 0.04606202 ,0.04063844],
 [ 0.03635463 ,0.03230118],
 [ 0.01423997 ,0.01497679],
 [ 0.02388396 ,0.0232874 ],
 [ 0.00057545 ,0.03946257],
 [ 0.02041391 ,0.02685061],
 [ 0.0307696  ,0.03691521],
 [ 0.05895367 ,0.02457475],
 [-0.02889105 ,0.03352988],
 [ 0.01515371 ,0.03654028],
 [-0.00026958 ,0.01166646],
 [ 0.02792929 ,0.01961227],
 [ 0.03934746 ,0.02825971],
 [ 0.0337595  ,0.02177928],
 [ 0.04736988 ,0.02437313],
 [ 0.01394216 ,0.01725141],
 [ 0.0217487  ,0.02927524],
 [-0.00262888 ,0.02879783],
 [ 0.05078371 ,0.04479903],
 [ 0.03668212 ,0.04390876],
 [ 0.02106555 ,0.03014867],
 [ 0.05284343 ,0.02956118],
 [ 0.0176741  ,0.05425617],
 [ 0.02824349 ,0.03087461],
 [ 0.02361738 ,0.03971014],
 [ 0.05284343 ,0.02956118],
 [-0.01117147 ,0.04705162],
 [-0.0032502  ,0.0370977 ],
 [ 0.02569146 ,0.05603915],
 [ 0.02528347 ,0.02662602],
 [ 0.01703943 ,0.03492068],
 [ 0.02792929 ,0.01961227],
 [-0.01032106 ,0.02822416],
 [ 0.03011414 ,0.02372707],
 [ 0.01422373 ,0.03566335],
 [-0.00314428 ,0.05109558],
 [ 0.01112177 ,0.04388003],
 [ 0.03546893 ,0.0286282 ],
 [ 0.05525905 ,0.05915879],
 [ 0.00394197 ,0.02918453],
 [ 0.03612268 ,0.04903205],
 [ 0.00332706 ,0.01698592],
 [ 0.00762538 ,0.02917886],
 [ 0.03454283 ,0.00551473],
 [ 0.0272348  ,0.0364371 ],
 [ 0.04031146 ,0.03769058],
 [-0.01030354 ,0.03982009],
 [ 0.03497209 ,0.03159935],
 [ 0.03550771 ,0.02515078],
 [ 0.04588893 ,0.05656957],
 [ 0.03817201 ,0.03213223],
 [ 0.03098103 ,0.03983062],
 [ 0.02106555 ,0.03014867],
 [ 0.012145   ,0.01111592],
 [ 0.03139885 ,0.04322976],
 [ 0.04344554 ,0.04998945],
 [ 0.00355384 ,0.0439034 ],
 [ 0.00160977 ,0.00993986],
 [ 0.01995772 ,0.04942393],
 [-0.00343478 ,0.03593113],
 [ 0.01872854 ,0.01562143],
 [ 0.03578344 ,0.01682963],
 [-0.02386951 ,0.02142496],
 [ 0.0359231  ,0.06633557],
 [ 0.04028883 ,0.03599001],
 [ 0.01185998 ,0.04125427],
 [-0.00470648 ,0.012783  ],
 [ 0.01621947 ,0.02901352],
 [ 0.03523987 ,0.05207088],
 [ 0.01495057 ,0.0444259 ],
 [ 0.01757706 ,0.0246233 ],
 [ 0.00414121 ,0.00956274],
 [ 0.02740487 ,0.02715897],
 [ 0.00664654 ,0.03103484],
 [-0.00928327 ,0.02082975],
 [ 0.0209143  ,0.03283028],
 [ 0.05214022 ,0.03235548],
 [-0.00861423 ,0.03517001],
 [ 0.0250491  ,0.03345587],
 [ 0.04935828 ,0.03198146],
 [ 0.02488196 ,0.03561238],
 [ 0.02124173 ,0.00729326],
 [-0.00803797 ,0.01978813],
 [ 0.02565903 ,0.01546157],
 [-0.00315182 ,0.04929072],
 [ 0.03843347 ,0.03603781],
 [-0.01722403 ,0.01036149],
 [ 0.01879541 ,0.02114938],
 [ 0.04129261 ,0.03885617],
 [ 0.00645204 ,0.02633238],
 [ 0.01061483 ,0.03003972],
 [ 0.03972975 ,0.02749049],
 [ 0.0322231  ,0.04129683],
 [ 0.03666344 ,0.03394639],
 [ 0.03845182 ,0.05050837],
 [-0.00162275 ,0.00470542],
 [-0.01659001 ,0.04207333],
 [ 0.00414568 ,0.03373724],
 [ 0.00996472 ,0.03502846],
 [ 0.03419379 ,0.02068129],
 [ 0.02015233 ,0.05404294],
 [ 0.01241945 ,0.03425456],
 [ 0.01718405 ,0.045762  ],
 [ 0.02381502 ,0.02764358],
 [ 0.00454027 ,0.04216978],
 [ 0.0382714  ,0.03589968],
 [-0.00515485 ,0.03460617],
 [ 0.02853105 ,0.02612829],
 [ 0.00938107 ,0.03509993],
 [ 0.03712874 ,0.04057218],
 [ 0.01974652 ,0.02976465],
 [ 0.04678818 ,0.00127504],
 [-0.01073159 ,0.0171646 ],
 [ 0.02426864 ,0.03550467],
 [ 0.01814273 ,0.03527951],
 [ 0.00972523 ,0.05117211],
 [ 0.05002637 ,0.03263758],
 [ 0.01674796 ,0.01970211],
 [ 0.02161775 ,0.05871143],
 [-0.00341755 ,0.03059104],
 [ 0.01316443 ,0.01912476],
 [ 0.0003231  ,0.02840103],
 [ 0.02473794 ,0.02182865],
 [ 0.03957402 ,0.04224691],
 [ 0.01507356 ,0.02970195],
 [ 0.00489112 ,0.02015199],
 [ 0.04532218 ,0.03163784],
 [ 0.02180873 ,0.0228725 ],
 [ 0.01240369 ,0.0032483 ],
 [ 0.01606065 ,0.04400348],
 [ 0.01555339 ,0.02367128],
 [ 0.03373184 ,0.03481411],
 [ 0.02415496 ,0.04606374],
 [ 0.03595999 ,0.02462981],
 [ 0.01290776 ,0.03105427],
 [ 0.04311418 ,0.03446491],
 [ 0.04034838 ,0.02641056],
 [ 0.01403274 ,0.03597756],
 [ 0.02157683 ,0.02885029],
 [ 0.02724225 ,0.04515677],
 [-0.02027912 ,0.02075023],
 [ 0.04678818 ,0.00127504],
 [ 0.01987968 ,0.03803982],
 [ 0.00027478 ,0.00102163],
 [ 0.01923761 ,0.03292943],
 [-0.00681032 ,0.02123802],
 [ 0.01284281 ,0.03326772],
 [ 0.00555977 ,0.03959732],
 [ 0.0203017  ,0.01703596],
 [-0.02436033 ,0.01086368],
 [-0.00060466 ,0.03982326],
 [ 0.01938121 ,0.03947292],
 [ 0.00856184 ,0.03333269],
 [ 0.03401995 ,0.04005316],
 [-0.00350972 ,0.03450003],
 [ 0.01203745 ,0.05412626],
 [ 0.01258456 ,0.03085136],
 [ 0.02544837 ,0.0325295 ],
 [-0.00887971 ,0.02351049],
 [ 0.02529822 ,0.03566315],
 [ 0.0210432  ,0.03016492],
 [ 0.02566699 ,0.02573635],
 [ 0.02415496 ,0.04606374],
 [ 0.01434101 ,0.03805881],
 [ 0.02740213 ,0.03331491],
 [ 0.04756143 ,0.0427061 ],
 [-0.00858239 ,0.03396334],
 [ 0.0047102  ,0.05887927],
 [ 0.03188534 ,0.03307118],
 [-0.00043959 ,0.04058443],
 [-0.02707692 ,0.01584031],
 [ 0.03800209 ,0.05090052],
 [ 0.03529314 ,0.05214987],
 [-0.00834887 ,0.0381826 ],
 [-0.01308021 ,0.03781654],
 [ 0.00998769 ,0.01948795],
 [ 0.03986352 ,0.03758938],
 [ 0.02038233 ,0.05152734],
 [-0.01239178 ,0.04391853],
 [ 0.00276739 ,0.04122811],
 [ 0.05596832 ,0.03901269],
 [ 0.0166179  ,0.03065361],
 [ 0.0407578  ,0.03362253],
 [ 0.04157175 ,0.00770847],
 [-0.01704095 ,0.02068902],
 [ 0.03986352 ,0.03758938],
 [-0.00474244 ,0.01481936],
 [ 0.02811672 ,0.04812254],
 [ 0.02353323 ,0.04783867],
 [ 0.0291584  ,0.05378936],
 [ 0.04091376 ,0.03918123],
 [ 0.01827826 ,0.01673649],
 [ 0.04087047 ,0.02656637],
 [ 0.03897531 ,0.0248124 ],
 [ 0.01953501 ,0.02423995],
 [-0.01571707 ,0.03806942],
 [ 0.00281186 ,0.01954962],
 [ 0.03477161 ,0.05069243],
 [-0.01643638 ,0.01744997],
 [ 0.02067272 ,0.0444505 ],
 [ 0.01521631 ,0.01827248],
 [ 0.01999248 ,0.05768436],
 [ 0.02130416 ,0.0227209 ],
 [-0.01397389 ,0.0479329 ],
 [-0.02395777 ,0.03569799],
 [ 0.02579852 ,0.03287361],
 [ 0.04204019 ,0.05023386],
 [ 0.05764989 ,0.04119105],
 [ 0.01697527 ,0.02425091],
 [-0.005193   ,0.01301008],
 [ 0.0040061  ,0.03444606],
 [ 0.0208343  ,0.04320389],
 [ 0.00028112 ,0.02890333],
 [ 0.0182626  ,0.02957163],
 [ 0.00037602 ,0.01112859],
 [ 0.02382092 ,0.01843712],
 [ 0.02646995 ,0.03195942],
 [ 0.03752632 ,0.03253337],
 [ 0.01894867 ,0.06087387],
 [ 0.01922372 ,0.03438395],
 [ 0.01506054 ,0.02644426],
 [ 0.01312473 ,0.037486  ],
 [ 0.05721674 ,0.04477991],
 [ 0.02526063 ,0.02081362],
 [-0.00622189 ,0.03668787],
 [ 0.02762726 ,0.03024931],
 [-0.00282808 ,0.03996093],
 [ 0.00693751 ,0.0405575 ],
 [ 0.01875644 ,0.02853346],
 [ 0.01367661 ,0.04573911],
 [ 0.01429171 ,0.0713149 ],
 [-0.00187472 ,0.02838752],
 [ 0.02418543 ,0.02125288],
 [ 0.03962586 ,0.03537366],
 [-0.01764573 ,0.04249291],
 [ 0.00105284 ,0.07298446],
 [ 0.02756311 ,0.02115813]])

colors= 10*["r","g","b","c","k"]
#plot.scatter(testData[:,0],testData[:,1],s=15)
#plot.show()

class K_Means:
    def __init__(self, k=3, tolerance=0.001, max_iterations=300):
        self.k=k
        self.tolerance = tolerance
        self.max_iter = max_iterations

    def getDistance(self,vec1,vec2):
        return im.getDocSimilarity(vec1,vec2)


    def fit(self, data):
        self.centroids={}
        for i in range(self.k):
            self.centroids[i] = data[i]

        for i in range(self.max_iter):
            self.classifications={}

            for j in range(self.k):
                self.classifications[j] = []

            for featureset in data:
                distances = [self.getDistance(featureset,self.centroids[centroid]) for centroid in self.centroids]
                classification = distances.index(min(distances))
                self.classifications[classification].append(featureset)

            prevCentroids = dict(self.centroids)

            for classification in self.classifications:
                if len(self.classifications[classification])>0:
                    self.classifications[classification] = np.average(self.classifications[classification],axis=0)

            optimized=True

            for c in self.centroids:
                originalCentroids= prevCentroids[c]
                currentCentroid = self.centroids[c]
                if np.sum((originalCentroids-currentCentroid)/originalCentroids*100.0) > self.tolerance:
                    optimized=False

            if optimized:
                break

    def predict(self,data):
        distances = [self.getDistance(data, self.centroids[centroid]) for centroid in self.centroids]
        classification = distances.index(min(distances))
        return classification

clf=K_Means()
clf.fit(testData)

for centroid in clf.centroids:
    plot.scatter(clf.centroids[centroid][0],clf.centroids[centroid][1],marker="o",color="k",s=100,linewidths=5)

for classification in clf.classifications:
    color= colors[classification]
    if len(clf.classifications[classification])>0:
        for featureSet in clf.classifications[classification]:
            plot.scatter(featureSet[0],featureSet[1],marker="x",color=color,s=100,linewidths=5)

plot.show()